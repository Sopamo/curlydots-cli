# Quickstart: CSV Translation with AI

**Feature**: 002-csv-translation  
**Date**: 2025-11-29

## Prerequisites

1. **Environment**: Bun.js installed
2. **API Key**: `OPENAI_API_KEY` environment variable set
3. **Input**: CSV file generated by `aitranslate extract`

## Installation

```bash
# Add OpenAI SDK dependency
bun add openai

# Add concurrency control
bun add p-limit

# Add CSV parsing/writing library
bun add fast-csv
```

## Usage

### Basic Translation

```bash
# Translate a CSV file
aitranslate translate missing-translations.csv

# Output: missing-translations-translated.csv
```

### With Options

```bash
# Specify output path
aitranslate translate input.csv --output translated.csv

# Increase parallelism (default: 5)
aitranslate translate input.csv --concurrency 10

# Force re-translate all rows (ignore existing translations)
aitranslate translate input.csv --force

# Skip confirmation prompt (for CI/scripts)
aitranslate translate input.csv --yes
```

### Resume Interrupted Translation

```bash
# Simply re-run with the output file as input
aitranslate translate missing-translations-translated.csv

# Only untranslated rows will be processed
```

## CLI Reference

```
aitranslate translate <csv> [options]

Arguments:
  csv                     Path to input CSV file

Options:
  -o, --output <path>     Output file path (default: <input>-translated.csv)
  -c, --concurrency <n>   Parallel API requests (default: 5)
  -f, --force             Re-translate all rows
  -y, --yes               Skip confirmation prompt
  -h, --help              Show help
```

## Input CSV Format

Required columns (generated by `aitranslate extract`):

| Column | Description |
|--------|-------------|
| translation_key | Key path (e.g., "users.show_all") |
| source_value | Text in source language |
| source_language | Source language code |
| target_language | Target language code |
| code_context | JSON array of code usage snippets |
| translation_context | JSON array of prior translation examples |

## Output CSV Format

Same as input, plus:

| Column | Description |
|--------|-------------|
| translated_value | AI-generated translation |

## Environment Variables

| Variable | Required | Description |
|----------|----------|-------------|
| OPENAI_API_KEY | Yes | OpenAI API key |

## Example Workflow

```bash
# 1. Extract missing translations
aitranslate extract ./my-app -s en -t de -d src/translations -o missing.csv

# 2. Translate with AI
aitranslate translate missing.csv -y

# 3. Review translations
cat missing-translated.csv

# 4. Import into your translation files (manual or custom script)
```

## Error Handling

- **Rate limits**: Automatic retry with exponential backoff
- **API errors**: Row marked as error, continues with next row
- **5 consecutive failures**: Process aborts, partial progress saved
- **Interrupted**: Re-run same command to resume

## Development

### Run Tests

```bash
bun test
```

### Type Check

```bash
bun run typecheck
```

### Lint

```bash
bun run lint
```
